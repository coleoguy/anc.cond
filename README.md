# Ancestral Condition Test Reproducibility Repository

This repository consolidates the code and data used to evaluate the ancestral condition (AncCond) test described in the accompanying manuscript. The project now has a streamlined layout with a single, well-documented function module, a focused set of simulation scripts that reproduce the power and false-positive analyses from the paper, scripts for creating manuscript figures, and the manuscript files themselves.

## Repository structure

```
.
├── R/                      # Core functions that implement AncCond
├── analyses/              # Reproducible simulation analyses from the paper
├── data/                  # Empirical datasets used in the manuscript
├── manuscript/            # Manuscript, figure scripts, and supporting docs
├── results/               # Saved analysis outputs (RData and RDS files)
└── README.md              # This document
```

### Core functions (`R/`)

* `anc_cond.R` – defines the AncCond test and helper utilities (`AncCond`, `summary.AncCond`, `plot.AncCond`, and supporting functions). Source this file in interactive R sessions or scripts before running any analysis:

```r
source("R/anc_cond.R")
```

The exported `AncCond()` function accepts a tree (`phylo`), a data frame with the tip labels, continuous trait, and discrete trait, and optional arguments to adjust the transition model, null simulations, and reporting verbosity.

### Analysis scripts (`analyses/`)

Each script is self-contained and may be executed from the repository root with `Rscript`. By default the scripts run modest numbers of simulations to keep runtimes reasonable; adjust the function arguments inside each script for larger experiments.

| Script | Purpose | Key parameters | Default output |
| ------ | ------- | -------------- | --------------- |
| `scaling_bidirectional_analysis.R` | Tests power under bidirectional transitions while scaling branches associated with extreme continuous trait values. | `n_trees`, `n_taxa`, `scaling_factors`, `rate`, `nsim`, `iter` | `results/scaling_bidirectional_results.rds` |
| `scaling_unidirectional_analysis.R` | Evaluates scenarios where gains of the derived state dominate (reverse transitions are extremely rare). | `n_trees`, `scaling_factors`, `forward_rate`, `reverse_rate`, `nsim`, `iter` | `results/scaling_unidirectional_results.rds` |
| `taxa_bidirectional_analysis.R` | Quantifies power as the number of taxa increases under a bidirectional transition model. | `taxa_grid`, `n_trees`, `rate`, `sigma`, `nsim`, `iter` | `results/taxa_bidirectional_results.rds` |
| `taxa_unidirectional_analysis.R` | Mirrors the taxa analysis when the discrete trait is effectively unidirectional. | `taxa_grid`, `forward_rate`, `reverse_rate`, `nsim`, `iter` | `results/taxa_unidirectional_results.rds` |

Each script sources `R/anc_cond.R`, sets a deterministic seed for reproducibility, and saves results as tidy `rds` objects. Existing `*.RData` files in `results/` contain legacy outputs preserved for reference.

To run, for example, the bidirectional scaling study:

```bash
Rscript analyses/scaling_bidirectional_analysis.R
```

### Manuscript and figures (`manuscript/`)

* `anc_cond_manuscript.pdf` and `anc_cond_manuscript.docx` – the primary manuscript in PDF and Word formats.
* `figure_scripts/` – R scripts that generate the figures referenced in the manuscript:
  * `figure1_four_panel.R`
  * `model_comparison.R`
  * `scaling_factor_plot.R`
  * `taxa_number_plot.R`
* `figures/` – static figure files as included in the manuscript.
* Additional supporting documents (`cover letter.doc`, `listofneeds.docx`, `response.docx`).

### Data (`data/`)

The `data/` directory provides all empirical datasets required by the analysis and figure scripts, including the whale phylogeny (`whales.tre`, `whale_sizes.csv`) and saved objects used to reproduce the main figures (`Fig1Tree.RData`, `Fig1ContTrait.RData`, `Fig1DiscSimMap.RData`).

### Results (`results/`)

The `results/` folder stores both historical `*.RData` objects produced during manuscript preparation and the new, cleaner `*.rds` outputs generated by the updated analysis scripts. Each new script writes a single `rds` file summarizing p-values across simulation replicates.

### Software requirements

All analyses rely on R (≥ 4.0 recommended) with the following packages installed:

```r
install.packages(c("phytools", "diversitree", "geiger"))
```

The scripts manage their own random seeds for reproducibility. When running large simulations, consider adjusting the `nsim`, `iter`, and loop parameters to balance precision and runtime.

### Getting started

1. Install the required R packages.
2. Clone the repository and set the working directory to the project root.
3. Source `R/anc_cond.R` in an interactive session, or execute any of the scripts in `analyses/` using `Rscript` as shown above.
4. Use the scripts in `manuscript/figure_scripts/` to recreate manuscript figures once the relevant result files are available.

### Contact

For questions about the analyses or manuscript, please consult the corresponding authors listed in the manuscript files.
